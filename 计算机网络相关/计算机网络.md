## IP地址

如何查看IP地址？ Windows上是 ipconfig，Linux上是ifconfig和ip addr(net-tools&iproute2)

**IP地址是一个网卡在网络世界的通讯地址，相当于现实世界的门牌号。**大部分网卡都有一个ip地址。

**IPv4** 地址总共是32位，比如：10.100.122.2，被分为4个部分，每部分8个bit。这样产生的IP地址数量很快就不够用了，于是就有了**IPv6**，比如：inet6 fe80::f816:3eff:fec7:7975/64 这个有128位。

**IPv4地址被分成了5类**：

<img src="C:\Users\theon\AppData\Roaming\Typora\typora-user-images\image-20201012155744190.png" alt="image-20201012155744190" style="zoom: 80%;" />

A B C 三类地址所能包含的主机数：

<img src="C:\Users\theon\AppData\Roaming\Typora\typora-user-images\image-20201012155850289.png" alt="image-20201012155850289" style="zoom:80%;" />

可以看出，C类地址能包含的最大主机数量很少，可能连一个网吧都不够用，而B类地址能包含的最大主机数量又太多，一般企业达不到这个规模，闲着的地址就浪费了。

D类是**组播地址**，使用这一类地址，属于某个组的机器都能收到。

**无类型域间选路（CIDR）**

- CIDR 打破了原来设计的几类地址的做法，将32位的IP地址一分为二，前面是网络号，后面是主机号。比如：10.100.122.2/24，这个IP地址有一个斜杠，后面有一个数字24。这种形式就是CIDR。表示前24位是网络号，后8位是主机号。
- 伴随CIDR存在的，一个是**广播地址**，10.100.122.255。如果发送这个地址，所有10.100.122网络里面的机器都可以收到。另一个是**子网掩码**，255.255.255.0。
- **将子网掩码和IP地址进行 AND 运算，就可以得到网络号**。

**公有 IP 地址和私有 IP地址**

- 上面表格中展示了私有地址范围，**私有IP地址**允许组织内部人员管理、分配和重复使用。而**公有IP地址**需要去专门的组织购买，统一分配。
- 比如有一个私有IP地址 192.168.0.x/24。这个地址能明显看出网络号是 192.168.0，后面是主机号，整个网络中的**第一个地址** 192.168.0.1 往往是这个私有网络的**出口地址**，而192.168.0.255就是**广播地址**。
- 再来看看 16.158.165.91/22 这个CIDR。这个地址的第一个地址是 16.158.<101001><00>.1，即 16.158.164.1。子网掩码是 255.255.<111111>
  <00>.0，即 255.255.252.0。广播地址为 16.158.<101001><11>.255，即
  16.158.167.255。

**ip addr**

<img src="C:\Users\theon\AppData\Roaming\Typora\typora-user-images\image-20201012163419557.png" alt="image-20201012163419557" style="zoom:80%;" />

上图是一个示例，其中

- 在 IP 地址的后面有个 **scope**，对于 eth0 这张网卡来讲，是 global，说明这张网卡是可以对外的，可以接收来自各个地方的包。对于 lo 来讲，是 host，说明这张网卡仅仅可以供本机相互通信。
- lo 全称是loopback，又称**环回接口**，往往会被分配到 127.0.0.1 这个地址。这个地址用于本机通信，经过内核处理后直接返回，不会在任何网络中出现。
- 10.100.122.2/24 是一个**IPv4地址**，inet6 fe80::f816:3eff:fec7:7975/64是一个**IPv6地址**，有128位。
- link/ether fa:16:3e:c7:79:75 brd ff:ff:ff:ff:ff:ff 是一个 **MAC地址**
- < BROADCAST,MULTICAST,UP,LOWER_UP > 是**网络设备的状态标识**

**MAC地址**

- MAC地址是一个网卡的**物理地址**，用十六进制，**6个byte**表示。
- MAC 地址号称**全局唯一**，不会有两个网卡有相同的 MAC 地址，而且网卡自生产出来，就带着这个地址。
- MAC 地址像是身份证，是一个**唯一的标识**。它的唯一性设计是为了组网的时候，不同的网卡放在一个网络里面的时候，可以不用担心冲突。从硬件角度，保证不同的网卡有不同的标识。
- **MAC 地址的通信范围比较小，局限在一个子网里面**。一旦跨子网通信，就需要IP地址。

**网络设备的状态标识 (net_device flags)**

- UP 表示网卡处于启动的状态；BROADCAST 表示这个网卡有广播地址，可以发送广播包；MULTICAST 表示网卡可以发送多播包；LOWER_UP 表示 L1 是启动的，也即网线插着的。MTU1500 是指最大传输单元 MTU 为 1500，这是以太网的默认值。
- 网络包是层层封装的。MTU 是二层 MAC 层的概念。MAC 层有 MAC 的头，以太网规定连 MAC 头带正文合起来，不允许超过 1500 个字节。正文里面有 IP 的头、TCP 的头、HTTP 的头。如果放不下，就需要分片来传输。
- qdisc pfifo_fast ：qdisc 全称是queueing discipline，中文叫排队规则。内核如果需要通过某个网络接口发送数据包，它都需要按照为这个接口配置的 qdisc（排队规则）把数据包加入队列。
- 最简单的 qdisc 是 pfifo，它不对进入的数据包做任何的处理，数据包采用先入先出的方式通过队列。pfifo_fast 稍微复杂一些，它的队列包括三个波段（band）。在每个波段里面，使用先进先出规则。
- 三个波段（band）的优先级也不相同。band 0 的优先级最高，band 2 的最低。如果 band 0里面有数据包，系统就不会处理 band 1 里面的数据包，band 1 和 band 2 之间也是一样。数据包是按照服务类型（Type of Service，TOS）被分配多三个波段（band）里面的。TOS 是IP 头里面的一个字段，代表了当前的包是高优先级的，还是低优先级的。

## DHCP与PXE

**如何配置IP地址**

- net-tools

  ```shell
  $ sudo ifconfig eth1 10.0.0.1/24
  $ sudo ifconfig eth1 up
  ```

- iproute2

  ```shell
  $ sudo ip addr add 10.0.0.1/24 dev eth1
  $ sudo ip link set up eth1
  ```

  