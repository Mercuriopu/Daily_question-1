## 概览

- **计算机网络**（简称网络）由若干**结点**（计算机、集线器、交换机、路由器等）和连接这些结点的**链路**组成。计算机网络把许多计算机连接在一起，而互联网则把许多网络连接在一起，是网络的网络。
- 计算机网络**【定义】**：计算机网络主要是由一些通用的、可编程的硬件互连而成的，而这些硬件并非专门用来实现某一特定目的。这些可编程的硬件能够用来传送多种不同类型的数据，并能支持广泛的和日益增长的应用。
- 互联网按工作方式可分划分为**边缘部分**与**核心部分**。**主机**在边缘部分，其作用是进行信息处理。**路由器**在核心部分，其作用是按存储转发方式进行分组交换。在互联网核心部分的路由器之间一般都用高速链路相连接，而在互联网边缘的主机接入到核心部分通常以相对较低速率的链路相连接。
- 边缘部分利用核心部分提供的服务，使众多主机之间能够互相通信并交换或共享信息。**计算机通信**是计算机进程间的通信。计算机网络采用的通信方式是**客户-服务器**方式和**对等连接方式**。
- 客户和服务器都是指通信中所涉及的应用进程。客户是服务请求方，服务器是服务提供方。对等连接指两台主机在通信时并不区分哪一个是服务请求方哪一个是服务提供方。
- **交换**就是按某种方式动态地分配传输线路的资源。**电路交换**方式需要三个步骤：**建立连接**=>**通话**=>**释放连接**。在通话的全部时间内，通话的两个用户**始终占用端到端的通信资源**。用电路交换来传送计算机数据时，**其线路传输效率往往很低**。
- 互联网现在采用**存储转发的分组交换技术**，以及三层ISP结构。分组交换通过将一个报文划分为几个等长数据段，在每个数据段前面加上一些有必要控制信息组成的**首部**后，就构成了一个个**分组**，然后再进行传送。
- 分组交换在传送数据之前不必先占用一条端到端的通信资源。使用存储转发的分组交换，实质上是采用了在数据通信过程中断续/动态分配传输带宽的策略。
- 按作用范围不同，计算机网络分为广域网WAN、城域网MAN、局域网LAN和个人区域网PAN。
- 计算机网络常用的**性能指标**有**①**速率（数据的传送速率，数据率，单位是bit/s）**②**带宽（单位时间内网络中的某信道所能通过的“最高数据率”，bit/s）**③**吞吐量（单位时间内通过某个网络的实际数据量，bit/s）**④**时延：发送时延（主机或路由器发送数据帧所需要的时间，数据帧长度/发送速率）；传播时延（电磁波在信道传播一定的距离需要花费的时间，信道长度/电磁波在信道上的传播速率）；处理时延（主机或路由器在收到分组时要花费一定的时间进行处理）；排队时延（分组在进入路由器后要先在输入队列中排队等待处理）**⑤**时延带宽积（传播时延*带宽，bit）**⑥**往返时间RTT（双向交互一次所需时间）**⑦**利用率：信道利用率；网络利用率。
- **网络协议**即协议，是为进行网络中的数据交换而建立的规则。**计算机网络的各层及其协议的结合，称为网络的体系结构**。
- <img src="E:\前端の道\Daily_question\计算机网络相关\images\体系结构.png" alt="体系结构" style="zoom: 80%;" />
- **计算机网络体系结构**
  - **应用层**：通过应用**进程间**的交互来完成特定**网络应用**。应用层交互的数据单位称为**报文**
  - **运输层**：负责向两台主机中进程之间的通信提供**通用的数据传输服务**。
    - **传输控制协议TCP**——提供面向连接的、可靠的数据传输服务，其数据传输的单位是**报文段**
    - **用户数据报协议UDP**——提供无连接的、尽最大努力的数据传输服务，其数据传输的单位时**用户数据报**
  - **网络层**：负责为分组交换网上的不同**主机**提供通信服务。数据传输单位是**分组**。
  - **数据链路层**：将网络层交下来的**IP数据报组装成帧**，在两个相邻节点间的链路上传送**帧**。
  - **物理层**：传送数据单位是**比特**。

- **实体**表示任何可发送或接受信息的硬件或软件进程。**协议**是控制两个对等实体（或多个实体）进行通信的规则的集合。**在协议的控制下，两个对等实体间的通信使得本层能够向上一层提供服务。要实现本层协议，还需要使用下面一层所提供的服务。**

## 物理层

- **物理层**的主要任务是确定与传输媒体的接口有关的一些特性，如机械特性、电气特性、功能特性和过程特性。物理层还需要完成传输方式的转换，因为数据在计算机内部多采用并行传输方式，但在通信线路上一般是串行传输，即逐个比特按时间顺序传输。物理层解决如何在连接各种计算机的媒体上传输数据比特流，而不是指具体的传输媒体。
- **数据通信**的一些基础知识
  - 一个**数据通信系统**可分为源系统（包括源点和发送器）、传输系统和目的系统（包括接收器和终点）三部分。
  - 通信的**目的**是传送消息。如话音、文字、图像、视频等。**数据**是运送消息的实体。**信号**则是数据的电气或电磁的表现。
  - 根据信号代表消息的参数的取值方式不同，信号可分为**模拟信号/连续信号**和**数字信号/离散信号**。代表数字信号不同离散数值的基本波形称为**码元**。
  - 信道一般表示向某一个方向传送信息的媒体。根据双方信息交互的方式，通信可分为**单工通信、半双工通信和全双工通信。**
  - 来自信源的信号叫做**基带信号**。信号要在信道上传输就要经过**调制**。调制有基带调制和带通调制之分。最基本的带通调制方法有**调幅、调频和调相**。
  - 要提供数据在信道上的传输速率，可以使用更好的传输媒体，或使用先进的调制技术。但**数据传输速率不可能被任意地提高**。
  - **奈氏准则**：在任何信道中，码元传输速率是有上限的，传输速率超过此上限，就会出现严重的码间串扰问题，使接收端对码元的判决成为不可能。
  - **信噪比**（dB）= 10 lg(S/N) (dB)，S/N 表示信号的平均功率和噪声的平均功率之比，分贝（dB）作为度量单位。
  - **香农公式**指出**信道的极限信息传输速率C = W log2(1+S/N) (bit/s)**。香农公式表明**信道的带宽或信道中的信噪比越大，信息的极限传输速率就越高**。

- **传输媒介**可分为两大类，即**导引型传输媒体（双绞线、同轴电缆或光纤）和非导引型传输媒体（无线或红外或大气激光）**。

- 电信领域使用的**电磁波频谱**

  ![电磁波频谱](E:\前端の道\Daily_question\计算机网络相关\images\电磁波频谱.png)

- 常用的**信道复用**技术有：

  - **频分复用 FDM**：用户分配到一定的频带后，在通信过程中自始至终都占用这个频带，可见**频分复用的所有用户在同样的时间内占用不同的带宽资源**。

  - **时分复用 TDM**：将时间划分为一段段等长的时分复用帧（TDM帧）。每一个时分复用的用户在每一个TDM帧中占用固定序号的时序。TDM信号又称等时信号，**时分复用的所有用户在不同的时间占用同样的频带宽度**

    ![FDM&TDM](E:\前端の道\Daily_question\计算机网络相关\images\FDM&TDM.png)

  - **统计时分复用 STDM**：是一种改进的时分复用，能明显提高信道的利用率（时分复用不能使用那些处于空闲的时隙，从而导致复用后信道利用率不高）。用户不固定占用某个信道，有空时间片就将数据放入。

    ![STDM](E:\前端の道\Daily_question\计算机网络相关\images\STDM.png)

  - **波分复用 WDM**：就是**光的频分复用**

    ![WDM](E:\前端の道\Daily_question\计算机网络相关\images\WDM.png)

  - **码分复用 CDM**，人们更常用的名词是**码分多址 CDMA**。每一个用户可以在同样的时间使用同样的频带进行通信。由于**各用户使用经过特殊挑选的不同码型，因此各用户之间不会造成干扰。**

- 用户到互联网的**宽带接入方法**有非对称数字用户线ADSL（用数字技术对现有的模拟电话用户线进行改造）、光纤同轴混合网HFC（在有线电视网的基础上开发的）和FTTx。

## 数据链路层

- **链路**是从一个结点到相邻结点的一段物理线路（有线或无线），**数据链路**则是在链路的基础上增加了一些必要的硬件（如网络适配器）和软件（如协议的实现）。

- 数据链路层使用的信道主要有**点对点信道**（使用**一对一**的点对点通信方式）和**广播信道**（使用**一对多**的广播通信方式。该信道上连接的主机很多，因此需要使用专门的共享信道协议来协调这些主机的数据发送）。

- 数据链路层传送的协议数据单位是**帧**。数据链路层把网络层交下来的数据构成帧发送到链路上，以及把接收到的帧中的数据取出并上交给网络层。

- 数据链路层三个基本问题是：**封装成帧、透明传输和差错控制**。

  - **封装成帧**：在一段数据的前后分别添加首部和尾部，便构成了一个帧。首部和尾部的一个重要作用就是进行**帧定界**（即确定帧的界限）。首部和尾部还包含许多必要的控制信息。每一种链路层协议都规定了所能传送的帧的**数据部分长度上限——最大传送单元MTU**。帧定界可以使用特殊的**帧定界符**，控制字符**SOH**放在一帧的最前面，表示帧的首部开始，另一个控制字符**EOT**表示帧的结束。

    ![封装成帧](E:\前端の道\Daily_question\计算机网络相关\images\封装成帧.png)

  - **透明传输**：**透明**表示某一个实际存在的事物看起来却好像不存在一样。**数据链路层透明传送数据**表示无论什么样的比特组合的数据，都能按照原样没有差错地通过这个数据链路层。可以通过**字节/字符填充**在控制字符“SOH”或“EOT”前面插入一个**转义字符ESC**来解决透明传输问题。

    ![透明传输](E:\前端の道\Daily_question\计算机网络相关\images\透明传输.png)

  - **差错检测**：比特在传输过程中可能会产生差错：1可能变成0，而0可能变成1，这就做**比特差错**。传输错误的比特占所有传输比特总数的比率称为**误码率BER**。目前数据链路层广泛使用**循环冗余检验CRC**的检错技术来保证数据传输的可靠性。为了检错而添加的冗余码常称为**帧检验序列FCS**。

    ![CRC](E:\前端の道\Daily_question\计算机网络相关\images\CRC.png)

    **【强调】：**在数据链路层若仅仅使用 CRC 差错检测技术，则只能做到对帧的**无差错接受**，即：”**凡是接收端数据链路层接受的帧，都能以非常接近于1的概率认为这些帧在传输过程中没有产生差错**“。

- **点对点协议PPP**：目前使用最广泛的数据链路层协议。

  - PPP协议就是用户计算机和 ISP 进行通信时所使用的数据链路层协议。

    ![PPP](E:\前端の道\Daily_question\计算机网络相关\images\PPP.png)

  - PPP协议的**特点**时：简单；只检测差错，而不是纠正差错；不使用序号，也不进行流量控制；可同时支持多种网络层协议。

  - **PPP帧的格式**：标识字段**F**表示一个帧的开始或结束，即帧的定界符。地址字段**A**和控制字段**C**没有其他定义，实际上并没有携带PPP帧的信息。尾部第一个字段是使用CRC的帧检验序列**FCS**。

    ![PPP帧的格式](E:\前端の道\Daily_question\计算机网络相关\images\PPP帧的格式.png)

  - PPP协议可使用同步传输，也可使用异步传输。使用异步传输时，使用**字节填充**来实现透明传输；使用同步传输时，使用**零比特填充**来实现透明传输。

- **局域网**的数据链路层

  - 局域网的**特点**：网络为一个单位所拥有，且地理范围和站点数目均有限。

  - 局域网的**优点**：具有广播功能，从一个站点可很方便地访问全网；便于系统的扩展和逐渐演变；提高系统的可靠性、可用性和生存性。

  - 局域网可按网络拓扑进行**分类**：星型网、环形网、总线网。

  - 局域网可使用多种传输媒体，如双绞线、光纤等。局域网工作层次跨越了数据链路层和物理层。这里我们讲的是其在数据链路层的技术。

  - **共享信道**需要考虑如何使众多用户能合理而方便地共享通信媒体资源，有两种方法：

    - **静态划分信道**，如前面说的频分复用、时分复用、码分复用等。用户只要分配到了信道就不会和其他用户发生冲突。但这种划分信道的方法代价较高，不适合局域网使用。
    - **动态媒体接入控制**，又称**多点接入**，特点是信道并非在用户通信时固定分配给用户。这里又分为两类：
      - **随机接入**：特点是所有用户可随机地发送信息，但可能会产生**碰撞**，从而导致用户的发送失败。因此，必须有解决碰撞的网络协议。
      - **受控接入**：特点是用户不能随机地发送信息而必须服从一定的控制。典型代表有分散控制的令牌环局域网和集中控制的多点线路**探询/轮询**。

  - IEEE 802 委员会曾把局域网的数据链路层拆成两层，即逻辑链路控制 LLC 子层（与传输媒体无关）和媒体接入控制MAC子层（与传输媒体有关）。但现在LLC子层已成为历史。

  - 计算机与外界局域网的通信需要通过通信**适配器**，又称网络接口卡或**网卡**。计算机的**硬件地址**就在适配器的ROM中。适配器上装有处理器和存储器。适配器和局域网之间的通信是通过电缆或双绞线以**串行传输方式**进行的，而适配器和计算机之间的通信则是通过计算机主板上的 I/O 总线以**并行传输方式**进行的，所以适配器一个重要功能就是进行数据**串行传输和并行传输的转换**。由于网络上的数据率和计算机总线上的数据率并不同，所以在适配器中必须装有对数据进行缓存的存储芯片。适配器在接收和发送各种帧时，若收到有差错的帧，则将该帧直接丢弃而不必通知计算机，当收到正确的帧，则用中断来通知该计算机，并交付协议栈中的网络层。

    ![适配器](E:\前端の道\Daily_question\计算机网络相关\images\适配器.png)

- **CSMA/CD 协议**
  - **总线**特点是：当一台计算机发送数据时，总线上所有计算机都能检测到这个数据。为在总线上实现一对一的通信，可以使每台计算机的适配器都有不同的地址。在发送数据帧时，在帧的首部写明接收站的地址。

  - 为通信简便

    - 以太网采用**无连接**的工作方式，对发送的数据帧**不进行编号，也不要求对方发回确认**。目的站收到有差错帧就把它丢弃，其他什么也不做。即**以太网提供的服务是尽最大努力的交付，及不可靠的交付**。**对有差错帧是否需要重传则有高层决定**，如TCP协议，如TCP发现丢失了数据，就会把这些数据重新传递给以太网进行重传，但**以太网并不知道这是重传帧，而是当作新的数据帧来发送**。

      总线上**在同一时间只能允许一台计算机发送数据**，并且以太网采用最简单的**随机接入**，为了减少冲突发送概率，以太网采用了**载波监听多点接入/碰撞检测 CSMA/CD**。

    - 以太网发送的数据都是用**曼彻斯特编码**的信号。

      ![曼彻斯特编码](E:\前端の道\Daily_question\计算机网络相关\images\曼彻斯特编码.png)

  - CSMA/CD**协议要点**是：**发送前先监听，边发送边监听，一旦发现总线上出现了故障，就立即停止发送。然后按照退避算法等待一段随机时间后再次发送。因此，每一个站在自己发送数据之后的一小段时间内，存在这遭遇碰撞的可能性。以太网上各站点都平等地争用以太网信道。**

  - 使用 CSMA/CD 协议时，因为一个站**不可能同时进行发送和接收**，因此使用 CSMA/CD 协议的以太网只能进行**半双工通信**。

  - **电磁波在 1km 电缆的传播时延约为 5 μs**，常把总线上的**单程端到端传播时延记为 τ**。最迟经过 **2τ** 的时间（即以太网端到端往返时间，**2τ**称为**争用期**）才能知道自己发送的数据和其他占发送的数据有没有发生碰撞。

    ![载波监听](E:\前端の道\Daily_question\计算机网络相关\images\载波监听.png)

  - 以太网使用**截断二进制指数退避算法**来确定碰撞后重传的时机：
    1. 规定基本退避时间为争用期  2τ，具体**争用期时间为 51.2 μs**。对于 10Mbit/s以太网，在争用期可发送512bit，即64字节，可以说争用期是**512比特时间**，也**可以直接使用比特作为争用期单位**。
    2. 从离散整数集合[0,1,…,(2^k^-1)]随即取出一个数 r，重传后推迟的时间是 r 倍的争用期。k=min(重传次数,10)。
    3. 当重传达 16 次仍不能成功时，则丢弃该帧，并向高层报告。
  - **凡长度小于 64 字节的帧都是由于冲突而异常终止的无效帧**。
  - **强化碰撞**：当发送数据的站一旦发现发生了碰撞，除了立即停止发送数据外，还要继续发送32bit或48bit的人为干扰信号，以便让所有用户都知道现在已经发生了碰撞。
  - 以太网还规定**帧间最小间隔为 9.6 μs**，相当于 96 比特时间。这样做是为了使刚刚收到数据帧的站的接收缓存来得及清理，做好接收下一帧的准备。

- 传统的总线以太网基本都是使用**集线器**的双绞线以太网。这种以太网在物理层上是星形网，但在逻辑上则是总线形网。集线器工作在物理层，它的每个接口仅仅简单地转发比特，不进行碰撞检测。

- **以太网的信道利用率**

  - 假定**发送帧需要的时间为 T~0~，等于帧长（bit）除以发送速率**。成功发送一个帧需要占用信道的时间是 **T~0~ + τ**，因为当一个站发送完最后一个比特时，这个比特还要在以太网上传播。

    ![发送一帧所需平均时间](E:\前端の道\Daily_question\计算机网络相关\images\发送一帧所需平均时间.png)

  - 定义参数**a**为以太网**单程端到端时延τ**与**帧的发送时间T~0~**之比：**a=τ/T~0~**。a—>0表示只要一发生碰撞，就立即能检测出来，并立即停止发送，因而信道资源被浪费时间少，因此**参数 a 的值应当尽可能少**。

  - **理想化情况下**：极限信道利用率 **S~max~=T~0~/(T~0~+τ)=1/(1+a)**

- **以太网的 MAC 层**
  - **以太网的硬件地址，即 MAC 地址实际上就是适配器地址或适配器标识符（固化在适配器的ROM地址中），与主机所在的地点无关。源地址和目的地址都是48位长**。

  - IEEE 的**注册管理机构 RA** 负责分配地址字段的6个字节中前三个字节，生产局域网适配器的厂家必须向 IEEE 购买这三个字节构成的号，即**组织唯一标识符 OUI**，地址字段后三个字节由厂家自行指派，称为**扩展标识符**。用这种方式得到的49位的地址称为 EUI-48，EUI表示**拓展的唯一标识符**。

  - IEEE规定地址字段的**第一字节的最低位为I/G位**，I/G为为0时，地址字段表示一个**单个站地址**，为1表示**组地址**，用来进行**多播**。IEEE规定地址地段的**第一字节的最低第二位为G/L位**，G/L为为0时是**全球管理**，为1时是**本地管理**。

  - 适配器有**过滤功能**。适配器从网络上每收到一个 MAC 帧就先用硬件检查 MAC 帧中的目的地址。如果是**发往本站的帧**则收下，然后再进行其它的处理。否则就将此帧丢弃，不再进行其他的处理。这里“发送本站的帧”包括：

    - **单播**帧（一对一），即收到的帧的 MAC 地址和本站的硬件地址相同。
    - **广播**帧（一对全体），即发送给本局域网上所有站点的帧（全1地址）。
    - **多播**帧（一对多），即发送给本局域网上一部分站点的帧。

  - **MAC 帧的格式**

    ![MAC帧](E:\前端の道\Daily_question\计算机网络相关\images\MAC帧.png)

    - 第三个字段是2字节的**类型字段**，用来标志上一层使用的是什么协议，以便把收到的 MAC 帧的数据上交给上一层的这个协议。

    - 第四个字段是**数据字段**，长度在46至1500之间。（46字节：**最小长度64字节**减去18字节的首部和尾部得出的数据字段的最小长度）。

    - 从上图可以看出，在传输媒体实际传送的要比 MAC 帧还多出 8 个字节。主要是为了使适配器时钟频率与发送端的时钟同步。

    - **问题1：**上图的MAC帧格式中，首部并没有一个帧长度（或数据长度）字段，那么，MAC子层怎样知道接收到的以太网帧中取出多少字节的数据交给上一层协议呢？

      **答**：以太网发送的数据都是用**曼彻斯特编码**的信号，在曼彻斯特编码的每一个码元的正中间一定有一次电压的转换。当发送方把一个以太网帧发送完毕后，就不再发送其他码元了，因此，发送方网络适配器的接口上的电压也就不再变化了。这样，接收方就很容易找到以太网帧的结束位置，这个位置往前数4个字节（FCS字段），就能确定数据字段的结束位置。

    - **问题2**：当数字字段长度小于46字节时，MAC子层就会在数据字段后加入一个整数字节的填充字段，以保证以太网的MAC帧不小于64字节。上层协议如何知道填充字段的数据字段长度呢？

      **答**：上层使用IP协议时，其首部有一个“总长度”字段。因此，“总长度”字段加上填充字段的长度，应当等于MAC帧数据字段的长度。

    - **无效的MAC帧**：①帧的长度不是整个字节②用收到的帧检验序列FCS查出有差错③收到的帧的MAC客户数据字段长度不在48-1500字节之间。对于检查出的无效MAC帧就简单地丢弃。以太网不负责重传丢弃的帧。

- **拓展的以太网**（对以太网的覆盖范围进行扩展）

  - 使用**集线器**可以在**物理层**扩展以太网（扩展后的以太网仍然是一个网络）。

  - **交换式集线器**常称为**以太网交换机**或第二层交换机（工作在**数据链路层**）。它就是一个**多接口的网桥**，而每个接口都直接与某台单主机或另一个集线器相连，且工作在全双工方式。以太网交换机还具有并行性，能同时连通许多对的接口，使每一对相互通信的主机都能像**独占通信媒体那样，无碰撞地传输数据**。

  - 以太网交换机的接口还有**存储器**，能在输出端口繁忙时把到来的帧进行缓存。

  - 以太网交换机是一种即插即用设备，其内部的帧**交换表**（又称**地址表**）是通过**自学习**算法自动地逐渐建立起来的。

  - 利用以太网交换机可以很方便地实现**虚拟局域网VLAN**，VLAN 是一些局域网网段构成的与地理位置无关的逻辑组，而这些网段具有某些共同的需求。每一个 VLAN 的帧都有一个明确的标识符，指明发送这个帧的计算机属于哪一个VLAN。

    ![VLAN](E:\前端の道\Daily_question\计算机网络相关\images\VLAN.png)

    在虚拟局域网上的每一个站都可以收到同一局域网上其他成员所发出的广播。

- **高速以太网**有 100 Mbit/s 的快速以太网、吉比特以太网和 10Gbit/s 的10吉比特以太网。最近还发展到100吉比特以太网。在宽带接入技术中，也常使用高速以太网进行接入。

